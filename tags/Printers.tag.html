<app-printers>
    <app-header></app-header>
    <div class="content">
        <div each="{ printer in printers }" class="imprimante">
            <div class="imprimante-carre">
                <div class="imprimante-titre">
                    <img src="image/ultimaker-ii.jpeg" alt="ultimaker" /> {printer.name}
                </div>
                <div class="imprimante-{printer.state}">
                    {printer.state}
                </div>
            </div>
        </div>       

    </div>
    <script>
        var tag = this;

        tag.printers = null;
        tag.Devices = [
            Device.init("E0:E5:CF:1E:68:87", "Imprimante 1", tag.updateDevice),
            Device.init("E0:E5:CF:1E:68:88", "Imprimante 2", tag.updateDevice),
            Device.init("E0:E5:CF:1E:68:89", "Imprimante 3", tag.updateDevice)
        ];


        tag.on("before-mount", function(){
            ble.scan([], 5, function () { }, tag.onError);
            tag.initConnexion();
        });

        tag.initConnexion = function () {
            for (let device in tag.Devices)
            {
                device = tag.Devices[device];
                setTimeout(device.controller.connect.bind(device.controller), 10000);
            }

        };

        tag.updateDevice = function (controller) {
            alert("Yay");
        };

        tag.onError = function (reason) {
                alert("ERROR: " + reason);
        }

    </script>
</app-printers>